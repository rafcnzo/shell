    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Shell Cashier Dashboard</title>
        <link rel="icon" href="../assets/images/logoshell.png">
        <link rel="stylesheet" href="../css/styles.css">
        <link rel="stylesheet" href="../css/place-order.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    

    </head>

    <body>

        <!-- Navigation -->
        <div class="container ">
            <header class="logo-img">
                <a class="navbar-brand" ></a>
                <nav class="navbar navbar-expand-lg">
                    <img src="../assets/images/logoshell.png" alt="Logo" class="navbar-logo" a href="./place-order.html">
                    <a href="./place-order.html" class="nav-link">Home</a>
                    <a href="./orders.html" class="nav-link">Orders</a>
                    <a href="../login.html" class="nav-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                        </svg></i></a>
                </nav>
            </header>
        </div>



        <!--Order Management-->
        <div class="container mt-4">
            <div class="row flex-lg-row-reverse  g-5 pt-5">
                <div class="col-lg-5 col-md-12 col-sm-12">
                    <div class="card p-4 mt-5 shadow-sm" style="border-radius: 15px;">
                    <div class="container">
                        <form class="place-order-form" id="orderForm">
                            <div class="form-group d-flex justify-content-between m-2">
                                <div>
                                    <label for="orderID">Order ID #</label>
                                    <input type="text" class="form-control" id="inputNoTransaksi" readonly>
                                </div>
                                <div class="m-2">  
                                <a href="./pelanggantambah.html" type="button" id="btnAddCustomer">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                        class="bi bi-person-fill-add" viewBox="0 0 16 16">
                                        <path
                                            d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                                        <path
                                            d="M2 13c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4" />
                                    </svg>
                                </a>
                                </div>
                            </div>

                            <div class="form-group mb-3">
                                <label for="place_order_date">Tanggal</label>
                                <input type="date" class="form-control" id="place_order_date">
                            </div>
                            <div class="form-group mb-3">
                                <label for="place_order_customerName">Nama Pelanggan</label>
                                <select class="form-control" id="place_order_customerName">
                                    <option value="" disabled selected>Pilih Nama Pelanggan</option>
                                    <!-- Options will be dynamically inserted here -->
                                </select>
                            </div>
                            <div class="form-group mb-3">
                                <label for="place_order_Method">Metode Pembayaran</label>
                                <select class="form-control" id="place_order_Method">
                                    <option value="" selected>Metode Pembayaran</option>
                                    <option value="Tunai">Tunai</option>
                                    <option value="Kartu Kredit">Kartu Kredit</option>
                                    <option value="Kartu Debit">Kartu Debit</option>
                                    <option value="Qris">Qris</option>
                                </select>
                            </div>
                            <div class="form-group mb-3">
                                <div class="m-2 d-flex justify-content-between total-items">
                                    <p>Total items: <span id="total-items">0</span></p>
                                    <button class="btn btn-link text-danger mb-2" onclick="">Clear all</button>
                                </div>
                                <div class="order-list" id="order-list">
                                    <!-- Order items will be dynamically inserted here -->
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <input type="text" class="form-control" id="additionalNotes"
                                    placeholder="Additional Notes">
                            </div>

                            <div class="form-group m-2 d-flex justify-content-between">
                                <div class="d-flex justify-content-md-between">
                                    <div class="mt-3 prices-list">
                                        <h5 class="total-price">Price: <span id="total"></span></h5>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-2 d-flex justify-content-end">
                                <button type="button" class="btn btn-danger p-3 m-1 btnClear" id="btnClear" onclick="">Clear</button>
                                <button type="submit" class="btn btn-primary p-3 m-1 btnPlaceOrder" id="btnPlaceOrder" onclick="submitOrder()">Place Order</button>
                            </div>
                        </form>
                    </div>
                </div>
                </div>

                <div class="col-lg-7 col-md-17 col-sm-20">
                    <h2 class="category">Categories</h2>
                    <div class="d-flex flex-wrap mb-3 justify-content-around" id="category-list">
                        <div class="category-card me-10 mb-10" onclick="filterProducts('1')">
                            <img src="../assets/images/bensin.png" alt="">
                            <p>Bensin</p>
                        </div>
                        <div class="category-card me-10 mb-10" onclick="filterProducts('2')">
                            <img src="../assets/images/oli.png" alt="Oli">
                            <p>Oli</p>
                        </div>
                        <div class="category-card me-10 mb-10" onclick="filterProducts('3')">
                            <img src="../assets/images/shell-care.png" alt="shell-care">
                            <p>Shell Care</p>
                        </div>
                        <div class="category-card me-10 mb-10" onclick="filterProducts('4')">
                            <img src="../assets/images/merch.png" alt="merch">
                            <p>Merch</p>
                        </div>
                    </div>
                    <div class="row" id="product-list"></div>
                </div>
                
        </div>
        </div>
        <script>
            // Ambil data barang dan pelanggan dari localStorage
            let barangList = JSON.parse(localStorage.getItem('barangList')) || [];
            let pelangganList = JSON.parse(localStorage.getItem('pelangganList')) || [];
            let cart = [];
            let transaksiList = JSON.parse(localStorage.getItem('transaksiList')) || [];
        
            // Fungsi untuk mengatur Order ID
            function setOrderID() {
                const inputTransaksi = document.getElementById('inputNoTransaksi');
                let newOrderID = transaksiList.length + 1; // Menggunakan jumlah transaksi sebagai Order ID baru
                inputTransaksi.value = String(newOrderID).padStart(3, '0');
            }
        
            // Panggil fungsi untuk mengatur Order ID saat halaman dimuat
            setOrderID();
        
            // Fungsi untuk filter produk berdasarkan kategori
            function filterProducts(kategori) {
                const filteredProducts = barangList.filter(product => product.kategori === kategori);
                displayProducts(filteredProducts);
            }
        
            // Fungsi untuk menampilkan produk yang telah difilter
            function displayProducts(products) {
                const productContainer = document.getElementById('product-list');
                productContainer.innerHTML = ''; // Kosongkan daftar produk sebelumnya
        
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.classList.add('col-md-4', 'mb-3');
                    productCard.innerHTML = `
                        <div class="card p-3 text-center shadow-sm" style="border-radius: 15px; overflow: hidden; background-color: #ffffff; border: 1px solid red;" onclick="addProductToCart('${product.no}', ${product.harga})">
                            <div class="card-body">
                                <h5 class="card-title" style="font-weight: bold; margin-bottom: 10px;">${product.nama}</h5>
                                <p class="card-text">${formatIDR(product.harga)}</p>
                                ${product.kategori === '2' ? '<input type="number" class="form-control mt-2" placeholder="Masukkan jumlah harga" oninput="calculateLiter(this.value, \'' + product.no + '\')">' : ''}
                            </div>
                        </div>
                    `;
                    productContainer.appendChild(productCard);
                });
            }
        
            // Fungsi untuk menambah produk ke keranjang
            function addProductToCart(productNo, harga) {
                const selectedProduct = barangList.find(product => product.no === productNo);
                if (selectedProduct) {
                    const existingProduct = cart.find(item => item.no === productNo);
                    if (existingProduct) {
                        existingProduct.qty += 1.0; // Mengubah qty menjadi float
                    } else {
                        selectedProduct.qty = 1.0; // Mengubah qty menjadi float
                        selectedProduct.harga = harga; // Simpan harga saat produk ditambahkan
                        cart.push(selectedProduct);
                    }
                    updateCartDisplay();
                }
            }
        
            // Fungsi untuk menghitung liter bensin berdasarkan jumlah harga
            function calculateLiter(amount, productNo) {
                const selectedProduct = barangList.find(product => product.no === productNo);
                if (selectedProduct) {
                    const liter = amount / parseFloat(selectedProduct.harga);
                    selectedProduct.qty = liter; // qty tetap bertipe float
                    updateCartDisplay();
                }
            }
        
            // Fungsi untuk mengupdate tampilan keranjang di bagian Order Management
            function updateCartDisplay() {
                const orderList = document.getElementById('order-list');
                const totalItemsElement = document.getElementById('total-items');
                const totalPriceElement = document.getElementById('total');
        
                // Kosongkan daftar order sebelumnya
                orderList.innerHTML = '';
        
                // Tambahkan setiap produk dalam keranjang ke daftar order
                cart.forEach((item, index) => {
                    const orderItem = document.createElement('div');
                    orderItem.classList.add('order-item', 'd-flex', 'justify-content-between', 'mb-2');
                    orderItem.innerHTML = `
                        <p>${item.nama} - ${formatIDR(item.harga)} x ${item.kategori === '2' ? item.qty.toFixed(2) + ' liter' : item.qty + ' pcs'}</p>
                        <button class="btn btn-danger btn-sm" onclick="removeItemFromCart(${index})">Remove</button>
                    `;
                    orderList.appendChild(orderItem);
                });
        
                // Update total item dan total harga
                const totalItems = cart.length;
                const totalPrice = cart.reduce((sum, item) => sum + (parseFloat(item.harga) * item.qty), 0);
        
                totalItemsElement.textContent = totalItems;
                totalPriceElement.textContent = `${formatIDR(totalPrice)}`;
            }
        
            // Fungsi untuk menghapus item dari keranjang
            function removeItemFromCart(index) {
                cart.splice(index, 1); // Hapus item di index yang dipilih
                updateCartDisplay(); // Update tampilan keranjang
            }
        
            // Fungsi untuk format harga ke IDR
            function formatIDR(number) {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(number);
            }
        
            // Mengisi daftar pelanggan dari localStorage
            function loadCustomers() {
                const customerSelect = document.getElementById('place_order_customerName');
                pelangganList.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.nama; // Pastikan 'no' sesuai dengan yang di localStorage
                    option.textContent = customer.nama;
                    customerSelect.appendChild(option);
                });
            }
            
        
            // Fungsi untuk mengirim order
            function submitOrder() {
                const orderID = document.getElementById('inputNoTransaksi').value;
                const orderDate = document.getElementById('place_order_date').value;
                const customerName = document.getElementById('place_order_customerName').value;
                const paymentMethod = document.getElementById('place_order_Method').value;
        
                // Validasi sebelum submit
                if (!customerName) {
                    alert('Pilih pelanggan terlebih dahulu.');
                    return;
                }
        
                if (cart.length === 0) {
                    alert('Tidak ada produk dalam keranjang.');
                    return;
                }
        
                // Hitung total transaksi dari keranjang
                let totalTransaksi = cart.reduce((sum, item) => {
                    return sum + (parseFloat(item.harga) * item.qty);
                }, 0);
        
                // Simpan transaksi utama ke localStorage
                const newTransaction = {
                    id: transaksiList.length + 1,
                    noTransaksi: orderID,
                    tanggal: orderDate,
                    pelanggan: customerName,
                    metodePembayaran: paymentMethod,
                    total: totalTransaksi,  // Menggunakan total yang telah dihitung
                };
        
                transaksiList.push(newTransaction);
                localStorage.setItem('transaksiList', JSON.stringify(transaksiList));
        
                // Simpan detail transaksi (produk-produk yang dibeli)
                let detailTransaksiList = JSON.parse(localStorage.getItem('detailTransaksiList')) || [];
        
                cart.forEach(item => {
                    const detailTransaksi = {
                        id: Date.now(),
                        noTransaksi: orderID,
                        kodeBarang: item.no || '000',  // Kode barang, gunakan default '000' jika tidak ada
                        namaBarang: item.nama,
                        qty: item.qty, // qty tetap bertipe float
                        harga: parseFloat(item.harga) || 0,  // Harga satuan pastikan sebagai angka
                        total: (parseFloat(item.harga) || 0) * item.qty  // Subtotal pastikan sebagai angka
                    };
        
                    detailTransaksiList.push(detailTransaksi);
                });
        
                localStorage.setItem('detailTransaksiList', JSON.stringify(detailTransaksiList));
        
                alert('Order berhasil disimpan!');
        
                // Clear cart dan reset form
                cart = [];
                updateCartDisplay();
                document.getElementById('orderForm').reset();
                setOrderID();
            }
        
            // Panggil fungsi untuk memuat pelanggan saat halaman dimuat
            loadCustomers();
        </script>
        
            
          
        
    </body>

    </html>
